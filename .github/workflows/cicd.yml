name: cicd

on:
  push:
    branches: [ staging ]
  pull_request:
    branches: [ staging ]
  workflow_dispatch:

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Compile
        run: echo Hello, world!
    

            
  DeployProd:
    name: Deploy to Production 
    runs-on: ubuntu-latest
    environment: 
      name: Production 
    steps:
      # - name: Install Python 3.6.15
      #   run: |
      #     mkdir -p ~/python
      #     cd ~/python
      #     wget https://github.com/actions/python-versions/releases/download/3.6.15-116025/python-3.6.15-linux-20.04-x64.tar.gz
      #     tar xzf python-3.6.15-linux-20.04-x64.tar.gz
      #     export PATH="$HOME/python/bin:$PATH"
      #     python --version  # Verify Python installation
      # - name: Install databricks cli
      #   run: |
      #     python -m pip install --upgrade databricks-cli
      # - name: Remote update Prod Repo
      #   env:
      #     DATABRICKS_HOST: ${{ secrets.DATABRICKS_HOST }}
      #     DATABRICKS_TOKEN: ${{ secrets.DATABRICKS_TOKEN }}
      #   run: |
      #     databricks repos update --branch production --path /Repos/shaswat@onebyzero/databricks_production
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Switch to production branch
        run: |
          git fetch --all
          git checkout -B production origin/production

      - name: Set Git user email and name
        run: |
          git config --global user.email "shaswatp19@gmail.com"
          git config --global user.name "Shaswat19"

      - name: Merge changes from staging
        run: |
          git merge origin/staging --no-edit --allow-unrelated-histories

      - name: Push changes to production branch
        env:
            GH_PAT: ${{ secrets.GH_PAT }}
        run: git push origin production
        
